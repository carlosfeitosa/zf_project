<?php 
/**
 * Layout padrão do sistema.
 */

// setando variaveis
$applicationHttpHome = $this->urlEncrypt($this->url(array('controller'=>'index'), null, true));
$applicationHttpImagesHome = $this->baseUrl('/images/');
$applicationHttpCSSHome = $this->baseUrl('/css/global.css');
$applicationHttpBaseUrl = $this->baseUrl();

// setando cabecalho
$this->doctype('XHTML1_STRICT');
$this->headTitle(APPLICATION_NAME_AND_VERSION);
$this->headTitle()->setSeparator(' :: ');
$this->headMeta()->appendHttpEquiv('Content-Type', 'text/html; charset=utf-8');
$this->headLink()->appendStylesheet($applicationHttpCSSHome);

// verificando ambiente
if (Basico_OPController_UtilOPController::ambienteDesenvolvimento()) {
    // verificando se existe usuario logado
    if (Basico_OPController_LoginOPController::existeUsuarioLogado()) {
    	// recuperando a descricao do perfil padrao do usuario logado na sessao
		$descricaoPerfilPadrao = Basico_OPController_PerfilOPController::retornaTraducaoPerfilPadraoUsuarioSessaoViaSQL();

		// setando o titulo da janela do navegador
		$this->headTitle("[ Perfil padrao: {$descricaoPerfilPadrao} ]");
    }

	// recuperando o request do usuario
	$request = Basico_OPController_UtilOPController::retornaUserRequest();
    // setando o titulo da janela do navegador
    $this->headTitle("[ MVC: {$request->getModuleName()}/{$request->getControllerName()}/{$request->getActionName()} ]");
}
?>
<html> 
<head>
    <?php echo $this->headTitle() ?>
    <?php echo $this->headMeta() ?>
    <?php echo $this->headLink() ?> 
    <style type="text/css">
         body, html { 
            font-family:helvetica,arial,sans-serif; 
            font-size:90%; 
            text-decoration: none;
         }
         
         body, html a { 
            text-decoration: none;
         }
    </style>
    <?php
        $this->dojo()->setDjConfig(array('usePlainJson' => true, 'locale' => Basico_OPController_PessoaOPController::retornaLinguaUsuario()))
                     ->addStylesheetModule(DOJO_STYLE_SHEET_MODULE)
                     ->setLocalPath($applicationHttpBaseUrl . DOJO_LOCAL_PATH)
                     ->addLayer($applicationHttpBaseUrl . DEFAULT_JAVASCRIPT_FILE_PATH);

        echo $this->dojo();
    ?>
    <?php echo $this->headScript()?>
   
</head> 
<body class="rochedo">
<div class="loading"></div>
<div id="header">
    <div id="header-logo">
           <?php echo "<a onClick='loading()' href=" . "'" . $applicationHttpHome . "'" . ">" . APPLICATION_NAME_AND_VERSION . "</a>" ?>
    </div>
    <div id="header-navigation">
		<?php if (!Basico_OPController_LoginOPController::existeUsuarioLogado()) { ?>
        <a onClick="loading()" href="<?php echo $this->urlEncrypt($this->url(
                                                         array('module'=>'basico', 'controller'=>'login', 'action'=>'cadastrarUsuarioNaoValidado'), 
                                                         null, 
                                                         true)) ?>"><?php echo $this->tradutor('MENU_ITEM_REGISTRE_SE') ?></a> |
		<?php }?>
		<?php if (Basico_OPController_LoginOPController::existeUsuarioLogado()) { ?>
		<a onClick="loading()" href="<?php echo $this->urlEncrypt($this->url(
                                                         array('module'=>'basico', 'controller'=>'dadosusuario', 'action'=>'index'), 
                                                         null, 
                                                         true)) ?>"><?php echo "Meu Perfil" ?></a> |
		<a onClick="loading()" href="<?php echo $this->urlEncrypt($this->url(
                                                         array('module'=>'basico', 'controller'=>'geradorformulario', 'action'=>'gerarformulario'), 
                                                         null, 
                                                         true)) ?>"><?php echo "Gerador de Formularios" ?></a> |
        <a onClick="loading()" href="<?php echo $this->urlEncrypt($this->url(
                                                         array('module'=>'basico', 'controller'=>'administrador', 'action'=>'index'), 
                                                         null, 
                                                         true)) ?>"><?php echo "Administração" ?></a> |
        <?php }?>
        <a onClick="loading()" href="<?php echo Basico_OPController_AutenticadorOPController::retornaLinkAutenticacaoUsuario($this, $this->url()) ?>"><?php if (!Basico_OPController_LoginOPController::existeUsuarioLogado()) echo "Login"; else echo "Logout";?></a>
    </div>
</div>
<div id="content">
<?php echo $this->layout()->content ?>
</div>

<br>

<div id="footer">
	<br>
	<div id="footer_poweredby">
		<a href="http://framework.zend.com/" target="_blank" ><img alt="Powered by ZendFramework" src="<?php echo $applicationHttpImagesHome . 'zf/PoweredBy_ZF_4LightBG.png' ?>" /></a>
	</div>
	<?php if (Basico_OPController_UtilOPController::ambienteDesenvolvimento()) {
				// recuperando a darahora atual, em microsegundos, do inicio do processamento
				$phpProcessingStartTime = Basico_OPController_SessionOPController::retornaInicioProcessamentoMicrosegundosPHPSessaoUsuario();
		
				// recuperando a datahora atual, em microsegundos
				$phpProcessingEndTime = Basico_OPController_UtilOPController::retornaMicrosegundosDateTimeAtual();

				// calculando tempo de execucao
				$tempoExecucaoPHP = Basico_OPController_UtilOPController::retornaDiferencaArredondadaMicrotime($phpProcessingEndTime, $phpProcessingStartTime);

				// limpando a datahora, em microsegundos, do inicio do processamento PHP
				Basico_OPController_SessionOPController::limpaRegistroInicioProcessamentoMicrosegundosPHPSessaoUsuario();

				// verificando se nao existe usuario logado no sistema
				if (!Basico_OPController_LoginOPController::existeUsuarioLogado()) {
					// setando o perfil padrao para "usuario nao logado"
					$descricaoPerfilPadrao = 'Usuario nao logado';
				}

				// instanciando e carregando array de informacoes de debug
           		$arrayInfo = array();
           		$arrayInfo['IP usuário sessão / usuário autenticado'] = Basico_OPController_UtilOPController::retornaUserIp() . " / " . Basico_OPController_SessionOPController::retornaIpUsuarioAutenticadoSessaoUsuario();
           		$arrayInfo['Perfil padrão'] 		   		   		  =  $descricaoPerfilPadrao;
           		$arrayInfo['MVC atual']                		   		  = "{$request->getModuleName()}/{$request->getControllerName()}/{$request->getActionName()}";
           		$arrayInfo['MVC anterior']             		   		  = Basico_OPController_SessionOPController::retornaUltimaUrlPoolRequests();
           		$arrayInfo['Tempo de execução do PHP'] 		   		  = $tempoExecucaoPHP;

           		// carregando o caminho para a acao de debug, caso ambiente de desenvolvimento
           		$chamadaJavaScriptDebugInfo = Basico_OPController_UtilOPController::retornaJavaScriptDialogMensagemViaArrayInfoDebugInfo($arrayInfo);
	?>
	<div align="left"><font size="-2"><a onClick="<?=$chamadaJavaScriptDebugInfo ?>" href='#'>[ debug info ]</a></font></div>
	<?php } ?> 
</div>

</body>
</html>
